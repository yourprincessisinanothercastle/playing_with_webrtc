webpackJsonp([1],{0:function(e,n){},"50oV":function(e,n,t){"use strict";t("zjNs");n.a={props:["games"]}},"55uo":function(e,n,t){"use strict";var a=t("woOf"),s=t.n(a),o=t("kbSe"),i=t("P/V/");n.a={components:{Game:i.a},data:function(){return{openGames:{},signaling:new o.a("https://ws.kwoh.de",this.onConnected,this.onDisconnected,this.onGames),server:"",channels:{},handshakeDone:!1}},methods:{publishOffer:function(e){var n=this;this.server=e,this.signaling.joinGame(e).then(function(e){n.channels=e,n.handshakeDone=!0,n.channels.reliable.onmessage=function(e){console.log("got reliable",JSON.parse(e.data))},n.channels.unreliable.onmessage=function(e){console.log("got unreliable",JSON.parse(e.data))}})},onDisconnected:function(){console.log("disconnected")},onConnected:function(e){console.log("connected")},onGames:function(e){console.log("ongames called"),this.openGames=s()({},e)},sendReliable:function(){this.channels.reliable.send("reliable stuff")},sendUnreliable:function(){this.channels.unreliable.send("unreliable stuff")}}}},"5xwq":function(e,n,t){"use strict";var a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{staticClass:"section"},[t("div",{staticClass:"container"},[t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("div",{staticClass:"field has-addons"},[t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.game_name,expression:"game_name"}],staticClass:"input",attrs:{type:"text",placeholder:"open game"},domProps:{value:e.game_name},on:{input:function(n){n.target.composing||(e.game_name=n.target.value)}}})]),e._v(" "),t("div",{staticClass:"control"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.seed,expression:"seed"}],staticClass:"input",attrs:{type:"text",placeholder:"seed"},domProps:{value:e.seed},on:{input:function(n){n.target.composing||(e.seed=n.target.value)}}})]),e._v(" "),t("div",{staticClass:"control"},[t("a",{staticClass:"button is-info",attrs:{disabled:e.gameIsOpen},on:{click:function(n){e.openGame()}}},[e._v("\n              open\n            ")])])])]),e._v(" "),e.gameIsOpen?e._e():t("div",{staticClass:"column"},[t("Games",{attrs:{games:e.games}})],1)])]),e._v(" "),e.gameIsOpen?t("div",{staticClass:"section"},[t("div",{staticClass:"container"},[t("div",{staticClass:"columns"},[t("div",{staticClass:"column"},[t("h5",{staticClass:"title"},[e._v("players")]),e._v(" "),e._l(Object.keys(e.players),function(n){return t("div",[e._v("\n            "+e._s(n)+"\n          ")])})],2)])])]):e._e()])},s=[],o={render:a,staticRenderFns:s};n.a=o},"8e0p":function(e,n,t){"use strict";var a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},s=[],o={render:a,staticRenderFns:s};n.a=o},"8qZA":function(e,n,t){"use strict";var a=t("50oV"),s=t("QcFa"),o=t("VU/8"),i=o(a.a,s.a,!1,null,null,null);n.a=i.exports},GK12:function(e,n){},M93x:function(e,n,t){"use strict";function a(e){t("hKA9")}var s=t("xJD8"),o=t("8e0p"),i=t("VU/8"),c=a,r=i(s.a,o.a,!1,c,null,null);n.a=r.exports},NHnr:function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var a=t("7+uW"),s=t("M93x"),o=t("YaEn"),i=t("GK12");t.n(i);a.a.config.productionTip=!1,new a.a({el:"#app",router:o.a,template:"<App/>",components:{App:s.a}})},NV4N:function(e,n,t){e.exports=function(){return new Worker(t.p+"cb660d2001df10f36107.worker.js")}},OhTj:function(e,n,t){"use strict";var a=t("mvHQ"),s=t.n(a),o=t("Xxa5"),i=t.n(o),c=t("fZjL"),r=t.n(c),l=t("Zrlr"),u=t.n(l),d=t("wxAW"),h=t.n(d),f=function(){function e(){u()(this,e),this.connectedPlayers=[],this.playerInputQueues={},this.playerChannels={}}return h()(e,[{key:"addPlayer",value:function(e,n,t,a){var s=this;this.connectedPlayers.push(e),this.playerInputQueues[e]={reliable:[],unreliable:[],data:[]},this.playerChannels[e]={reliable:n,unreliable:t,data:a},n.onmessage=function(n){s._addMessage(e,"reliable",n)},t.onmessage=function(n){s._addMessage(e,"unreliable",n)}}},{key:"rmPlayer",value:function(e){this.connectedPlayers=this.connectedPlayers.filter(function(n){return n!==e}),delete this.playerInputQueues[e],delete this.playerChannels[e]}},{key:"_addMessage",value:function(e,n,t){this.playerInputQueues[e][n].push(t.data)}},{key:"getMessages",value:i.a.mark(function e(){var n,t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=r()(this.playerInputQueues),e.t0=i.a.keys(this.playerInputQueues);case 2:if((e.t1=e.t0()).done){e.next=22;break}t=e.t1.value;case 4:if(!(this.playerInputQueues[t].reliable.length>0)){e.next=9;break}return e.next=7,{client_id:t,message:this.playerInputQueues[t].reliable.shift()};case 7:e.next=4;break;case 9:if(!(this.playerInputQueues[t].unreliable.length>0)){e.next=14;break}return e.next=12,{client_id:t,message:this.playerInputQueues[t].unreliable.shift()};case 12:e.next=9;break;case 14:if(!(this.playerInputQueues[t].data.length>0)){e.next=19;break}return e.next=17,{client_id:t,message:this.playerInputQueues[t].data.shift()};case 17:e.next=14;break;case 19:return e.abrupt("return");case 22:case"end":return e.stop()}},e,this)})},{key:"broadcastUnreliable",value:function(e){for(var n in this.playerChannels)this.sendMessageUnreliable(n,e)}},{key:"broadcastReliable",value:function(e){for(var n in this.playerChannels)this.sendMessageReliable(n,e)}},{key:"multicastReliable",value:function(e,n){e.forEach(function(e){sendMessageReliable(e,n)})}},{key:"multicastUnreliable",value:function(e,n){toIDs.forEach(function(e){sendMessageUnreliable(e,n)})}},{key:"sendMessageReliable",value:function(e,n){this.playerChannels[e].reliable.send(s()(n))}},{key:"sendMessageUnreliable",value:function(e,n){this.playerChannels[e].unreliable.send(s()(n))}}]),e}();n.a=f},Omrz:function(e,n,t){e.exports=function(){return new Worker(t.p+"33b7af8ecee70265f4ff.worker.js")}},OqkE:function(e,n,t){"use strict";var a=function(){var e=this,n=e.$createElement;return(e._self._c||n)("canvas",{ref:"myCanvas",attrs:{width:"400",height:"400"}})},s=[],o={render:a,staticRenderFns:s};n.a=o},"P/V/":function(e,n,t){"use strict";var a=t("pzCy"),s=t("OqkE"),o=t("VU/8"),i=o(a.a,s.a,!1,null,null,null);n.a=i.exports},PoaM:function(e,n,t){"use strict";var a=t("OhTj");n.a=new a.a},QcFa:function(e,n,t){"use strict";var a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("h5",{staticClass:"title"},[e._v("open games")]),e._v(" "),t("ul",e._l(Object.keys(e.games),function(n){return t("li",[e._v(e._s(n))])}))])},s=[],o={render:a,staticRenderFns:s};n.a=o},SjLv:function(e,n,t){"use strict";var a=t("fB9/"),s=t("5xwq"),o=t("VU/8"),i=o(a.a,s.a,!1,null,null,null);n.a=i.exports},Vn6l:function(e,n,t){"use strict";var a=t("fZjL"),s=t.n(a),o=t("Zx67"),i=t.n(o),c=t("Zrlr"),r=t.n(c),l=t("wxAW"),u=t.n(l),d=t("zwoO"),h=t.n(d),f=t("Pf15"),p=t.n(f),v=t("DmT9"),m=(t.n(v),t("zjNs")),g=t("sYwf"),C=function(e){function n(e,t,a,s,o){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){},l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){};r()(this,n);var u=h()(this,(n.__proto__||i()(n)).call(this,e,t,a));return u.onNewPlayer=c,u.onPlayerQuit=l,u.socket.on("games",function(e){s(e)}),u.socket.on("game_open",function(e){o()}),u.socket.on("message",function(e){var n=e.from;switch(e.data.type){case"offer":u.connections[n]=new g.a(u,n,u.callbackIfComplete(n),function(e){return u.onPeerDisconnect(e)}),u.connections[n].answerOffer(e.data);break;case"iceCandidate":u.connections[n].addIceCandidate(e.data.candidate)}}),u}return p()(n,e),u()(n,[{key:"onPeerDisconnect",value:function(e){this.connections[e]&&(console.log("player quit",e),console.log(this.connections.clientId),this.connections[e].close(),delete this.connections[e],this.onPlayerQuit())}},{key:"callbackIfComplete",value:function(e){var n=this;return function(t){console.log("got channel"),3==s()(n.connections[e].dataChannels).length&&(console.log("done! resolving with",n.connections[e].dataChannels),n.onNewPlayer(e,n.connections[e].dataChannels))}}},{key:"openGame",value:function(e){this.socket.emit("open_game",{game_name:e})}},{key:"getGames",value:function(){this.socket.emit("get_games")}}]),n}(m.a);n.a=C},YaEn:function(e,n,t){"use strict";var a=t("7+uW"),s=t("/ocq"),o=t("SjLv"),i=t("tpm7");a.a.use(s.a),n.a=new s.a({routes:[{path:"/server",name:"Server",component:o.a},{path:"/",name:"Client",component:i.a}]})},"cy+6":function(e,n,t){"use strict";var a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("div",{staticClass:"section"},[t("div",{staticClass:"container"},[t("div",{staticClass:"columns"},[e.server?t("div",{staticClass:"column"},[t("button",{staticClass:"button",on:{click:function(n){e.sendReliable()}}},[e._v("send something reliable")]),e._v(" "),t("button",{staticClass:"button",on:{click:function(n){e.sendUnreliable()}}},[e._v("send something unreliable")])]):t("div",{staticClass:"column"},[t("h5",{staticClass:"title"},[e._v("join game")]),e._v(" "),e._l(Object.keys(e.openGames),function(n){return t("div",[t("a",{staticClass:"button",on:{click:function(t){e.publishOffer(e.openGames[n].server)}}},[e._v(" "+e._s(n))])])}),e._v(" "),0===Object.keys(e.openGames).length?t("div",[e._v("\n            no games open\n          ")]):e._e()],2),e._v(" "),t("div",{staticClass:"column"},[t("router-link",{attrs:{to:{name:"Server"}}},[e._v("...or be the server")])],1)])])]),e._v(" "),e.handshakeDone?t("div",{staticClass:"section"},[t("div",{staticClass:"container"},[t("Game",{attrs:{channels:e.channels}})],1)]):e._e()])},s=[],o={render:a,staticRenderFns:s};n.a=o},"fB9/":function(e,n,t){"use strict";var a=t("woOf"),s=t.n(a),o=t("8qZA"),i=t("Vn6l"),c=t("sQDe");n.a={components:{Games:o.a},data:function(){return{games:{},game_name:"",seed:"123",gameIsOpen:!1,players:{},signaling:new i.a("https://ws.kwoh.de",this.onConnect,this.onDisconnect,this.onGames,this.onGameOpened,this.onNewPlayer,this.onPlayerQuit),game:null,tiles:{}}},methods:{onConnect:function(){},onDisconnect:function(){},onGames:function(e){this.games=s()({},e)},onGameOpened:function(){console.log("disableing"),this.gameIsOpen=!0,this.game=new c.a(this.seed,this.onAddTile)},openGame:function(){this.signaling.openGame(this.game_name)},onNewPlayer:function(e,n){console.log("new player!",e,n),this.game.addPlayer(e,n.reliable,n.unreliable),this.players=s()({},this.game.players)},onPlayerQuit:function(e){},onAddTile:function(e,n,t){}}}},hKA9:function(e,n){},kbSe:function(e,n,t){"use strict";var a=t("//Fk"),s=t.n(a),o=t("fZjL"),i=t.n(o),c=t("Zx67"),r=t.n(c),l=t("Zrlr"),u=t.n(l),d=t("wxAW"),h=t.n(d),f=t("zwoO"),p=t.n(f),v=t("Pf15"),m=t.n(v),g=t("DmT9"),C=(t.n(g),t("zjNs")),y=t("sYwf"),k=function(e){function n(e,t,a,s){u()(this,n);var o=p()(this,(n.__proto__||r()(n)).call(this,e,t,a));return o.socket.on("games",function(e){console.log("got games"),s(e)}),o.socket.on("game_open",function(e){console.log("game open"),onGameOpened()}),o.socket.on("message",function(e){switch(e.data.type){case"answer":o.connections[e.from].processAnswer(e.data);break;case"iceCandidate":o.connections[e.from].addIceCandidate(e.data.candidate)}}),o}return m()(n,e),h()(n,[{key:"resolveIfComplete",value:function(e,n){var t=this;return function(a){console.log("got channel"),3==i()(t.connections[e].dataChannels).length&&(console.log("done! resolving with",t.connections[e].dataChannels),n(t.connections[e].dataChannels))}}},{key:"joinGame",value:function(e){var n=this;return new s.a(function(t,a){n.connections[e]=new y.a(n,e,n.resolveIfComplete(e,t)),n.connections[e].addDataChannel("reliable",{}),n.connections[e].addDataChannel("data",{}),n.connections[e].addDataChannel("unreliable",{maxRetransmits:0,ordered:!1}),n.connections[e].sendOffer()})}}]),n}(C.a);n.a=k},"mR+U":function(e,n,t){"use strict";var a={MESSAGING:"messaging",TILE:"tile",TILEIMAGE:"tileimage"},s={INIT:"init"},o={RELIABLE:"reliable",UNRELIABLE:"unreliable"};n.a={RTCMESSAGETYPE:"msgtype",WORKER_MAIN_MESSAGETYPES:a,MAIN_WORKER_MESSAGETYPES:s,RELIABILITY:o,TILESIZE:32}},pzCy:function(e,n,t){"use strict";var a=t("50uv");t.n(a);n.a={props:["channels"],mounted:function(){console.log("mounted game"),console.log(a),console.log(this.channels);var e=this.$refs.myCanvas;a.autoDetectRenderer(400,400,{view:e})}}},sQDe:function(e,n,t){"use strict";var a=t("Zrlr"),s=t.n(a),o=t("wxAW"),i=t.n(o),c=t("PoaM"),r=t("mR+U"),l=t("NV4N"),u=t.n(l),d=t("Omrz"),h=t.n(d),f=function(){function e(n){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:console.log;s()(this,e),this.players={},this.onAddTile=function(e,n,t){return a(e,n,t)},this.seed=n,this.tileWorker=new u.a,this.worker=new h.a,this.worker.onmessage=function(e){return t.processWorkerMessage(e)},this.setUpWorkerCommunication()}return i()(e,[{key:"setUpWorkerCommunication",value:function(){var e=new MessageChannel;this.tileWorker.postMessage({type:r.a.MAIN_WORKER_MESSAGETYPES.INIT,port:e.port1},[e.port1]),this.worker.postMessage({type:r.a.MAIN_WORKER_MESSAGETYPES.INIT,tileWorkerPort:e.port2,seed:this.seed},[e.port2])}},{key:"processWorkerMessage",value:function(e){r.a.WORKER_MAIN_MESSAGETYPES.TILEIMAGE?(console.log("got tile",new Uint8ClampedArray(e.data.data)),this.onAddTile(e.data.x,e.data.y,e.data.data)):console.error("unknown message",e.data)}},{key:"addPlayer",value:function(e,n,t,a){c.a.addPlayer(e,n,t,a)}}]),e}();n.a=f},sYwf:function(e,n,t){"use strict";var a=t("//Fk"),s=t.n(a),o=t("Zrlr"),i=t.n(o),c=t("wxAW"),r=t.n(c),l={iceServers:[{urls:["stun:stun.l.google.com:19302"]}]},u=function(){function e(n,t){var a=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};i()(this,e),this._sendMessage=function(e){n.sendMessage(t,e)},this.onDatachannelOpen=function(e){return s(e)},this.target=t,this.dataChannels={},this.peerConnection=new RTCPeerConnection(l),this.peerConnection.ondatachannel=function(e){a.onDataChannel(e)},this.peerConnection.onicecandidate=function(e){a.onIceCandidate(e)},this.peerConnection.oniceconnectionstatechange=function(e){switch(console.log("connectionstate changed",e),console.log(a.peerConnection.iceConnectionState),a.peerConnection.iceConnectionState){case"connected":console.log("new connection");break;case"disconnected":case"closed":case"failed":o(t),console.error("connection failed",e)}}}return r()(e,[{key:"close",value:function(){this.peerConnection.close()}},{key:"getChannels",value:function(){return s.a.all(this.datachannelPromises)}},{key:"onIceCandidate",value:function(e){e&&e.candidate&&this.sendIceCandidate(e.candidate)}},{key:"onDataChannel",value:function(e){var n=this;e.channel.onopen=function(e){n.dataChannels[e.target.label]=e.target,console.log("datachannel!",n.dataChannels),n.onDatachannelOpen(e)}}},{key:"addDataChannel",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.peerConnection.createDataChannel(e,t);return a.onopen=function(e){console.log("datachannel!",n.dataChannels),n.dataChannels[e.currentTarget.label]=e.currentTarget,n.onDatachannelOpen(e)},a}},{key:"processAnswer",value:function(e){this.peerConnection.setRemoteDescription(new RTCSessionDescription(e))}},{key:"sendOffer",value:function(){var e=this;return this._createOffer().then(function(n){e._sendMessage(n)})}},{key:"answerOffer",value:function(e){var n=this;this._processOffer(e).then(function(e){n._sendMessage(e)})}},{key:"sendIceCandidate",value:function(e){this._sendMessage({type:"iceCandidate",candidate:e})}},{key:"addIceCandidate",value:function(e){this.peerConnection.addIceCandidate(new RTCIceCandidate(e))}},{key:"_createOffer",value:function(){var e=this;return this.peerConnection.createOffer().then(function(n){return e.peerConnection.setLocalDescription(n),n}).catch(function(e){console.error("error creating offer",e)})}},{key:"_processOffer",value:function(e){var n=this;return this.peerConnection.setRemoteDescription(new RTCSessionDescription(e)).catch(console.error),this.peerConnection.createAnswer().then(function(e){return n.peerConnection.setLocalDescription(e),e})}}]),e}();n.a=u},tpm7:function(e,n,t){"use strict";var a=t("55uo"),s=t("cy+6"),o=t("VU/8"),i=o(a.a,s.a,!1,null,null,null);n.a=i.exports},xJD8:function(e,n,t){"use strict";n.a={name:"app"}},zjNs:function(e,n,t){"use strict";var a=t("Zrlr"),s=t.n(a),o=t("wxAW"),i=t.n(o),c=t("DmT9"),r=t.n(c),l=(t("sYwf"),function(){function e(n,t,a){s()(this,e),this.socket=r()(n),this.onConnect=t,this.onDisconnect=a,this.connections={},this.socket.on("connect",function(){t()}),this.socket.on("disconnect",function(){a()})}return i()(e,[{key:"sendMessage",value:function(e,n){console.log("sending",n,e),this.socket.emit("message",n,e)}}]),e}());n.a=l}},["NHnr"]);
//# sourceMappingURL=app.4e58e01096f757857561.js.map